# Task 0.8 — Tailwind v4 Strategy (OQ-1)

Goal: decide how to handle dynamic Tailwind classes generated by Puck components while keeping bundle size predictable and build tooling simple.

## Decision Matrix

| Option | Pros | Cons | Verdict |
| --- | --- | --- | --- |
| Safelist file (recommended) | Works offline, predictable purge behavior, aligns with repo-owned config; easy to review diff; supports both Tailwind 3.x (current) and future 4.x | Requires upkeep when adding new dynamic tokens; needs tooling to generate/update | ✅ Adopt |
| CDN runtime (jit-in-browser) | Zero build config; instant class availability | Larger runtime cost, cache dependence, harder to audit CSS size, slower cold loads | ❌ Reject |
| Static preset classes only | Simplest purge story; no safelist maintenance | Limits design flexibility for layout/spacing variants; brittle when adding new components | ⚠️ Partial (keep small preset set, but not sole strategy) |

## Recommendation (Chosen)

- Maintain a repository-owned safelist file that enumerates dynamic classes used by Puck components (e.g., grid columns, gaps, text alignment). Proposed location: `frontend/widget/tailwind.safelist.txt` with one class per line.
- Continue using Tailwind **3.4.14** in the current widget until a planned upgrade to v4; structure safelist to be compatible with v4 syntax when upgrading.
- Keep a minimal preset of common tokens (`grid-cols-1..4`, `gap-sm|md|lg|xl`, `text-left|center|right`, `p-2|4|6|8`) to avoid overgrowth.
- Avoid CDN runtime to keep bundle deterministic and offline-friendly.
- Status: safelist file created at `frontend/widget/tailwind.safelist.txt` and wired via `safelist` in `frontend/widget/tailwind.config.cjs`.
- Test coverage: Storybook Grid+Card story and POC tests rely on safelisted classes (`grid-cols-*`, `gap-*`, `text-*`, `max-w-*`); keep safelist updated when adding new variants.

## Implementation Notes

- Hook safelist into Tailwind config when running builds or Storybook (e.g., read file and push into `safelist` array). For v4 migration, reuse the file with the new config shape.
- When adding new components, update the safelist alongside docs/tests. Prefer generating entries from ComponentConfig metadata to reduce manual drift.
- Document safelist updates in component PRs so reviewers can audit class growth.

## Next Steps

1. Create `frontend/widget/tailwind.safelist.txt` with the initial class set above.
2. Add a small helper script/config snippet to load the safelist into Tailwind (to be placed in the production repo, not this documentation directory).
3. Re-evaluate after Tailwind v4 lands in the repo; ensure Slot/inline examples still map cleanly.
